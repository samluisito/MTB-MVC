# === MEJORAS DE SEGURIDAD Y CONFIGURACIÓN GENERAL ===
# Deshabilitar el listado de directorios para mayor seguridad.
Options -Indexes
# Seguir enlaces simbólicos (necesario para que mod_rewrite funcione).
Options +FollowSymLinks

# === COMPRESIÓN (mod_deflate) ===
# Comprime los tipos de archivo más comunes para acelerar la carga del sitio.
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/vnd.ms-fontobject
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-ttf
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE font/opentype
  AddOutputFilterByType DEFLATE font/truetype
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE image/x-icon
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
</IfModule>

# === CACHÉ DEL NAVEGADOR (mod_expires) ===
# Define por cuánto tiempo el navegador debe cachear los diferentes tipos de archivos.
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresDefault                              "access plus 1 month"
  # No cachear documentos dinámicos y de datos
  ExpiresByType text/html                     "access plus 0 seconds"
  ExpiresByType text/xml                      "access plus 0 seconds"
  ExpiresByType application/xml               "access plus 0 seconds"
  ExpiresByType application/json              "access plus 0 seconds"
  # Feeds
  ExpiresByType application/rss+xml           "access plus 1 hour"
  ExpiresByType application/atom+xml          "access plus 1 hour"
  # Favicon
  ExpiresByType image/x-icon                  "access plus 1 week"
  # Archivos multimedia
  ExpiresByType image/gif                     "access plus 1 month"
  ExpiresByType image/png                     "access plus 1 month"
  ExpiresByType image/jpeg                    "access plus 1 month"
  ExpiresByType image/webp                    "access plus 1 month"
  ExpiresByType video/ogg                     "access plus 1 month"
  ExpiresByType audio/ogg                     "access plus 1 month"
  ExpiresByType video/mp4                     "access plus 1 month"
  ExpiresByType video/webm                    "access plus 1 month"
  # CSS, JavaScript y Fuentes se cachean por más tiempo
  ExpiresByType text/css                      "access plus 1 year"
  ExpiresByType application/javascript        "access plus 1 year"
  ExpiresByType font/opentype                 "access plus 1 year"
  ExpiresByType font/truetype                 "access plus 1 year"
  ExpiresByType font/woff                     "access plus 1 year"
  ExpiresByType font/woff2                    "access plus 1 year"
</IfModule>

# === REGLAS DE REESCRITURA (mod_rewrite) ===
# Habilitar el motor de reescritura de URLs.
<IfModule mod_rewrite.c>
  RewriteEngine On

  # --- CONFIGURACIÓN DE ERRORES PARA DESARROLLO ---
  # ADVERTENCIA: Estas directivas deben ser eliminadas o comentadas en un entorno de producción.
  php_flag display_errors on
  php_flag display_startup_errors on
  php_value error_reporting -1

  # Redirige todas las solicitudes a archivos o directorios que no existen al controlador frontal (index.php).
  # Este es el patrón estándar para frameworks MVC.
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]

  # --- Regla para eliminar la extensión .php (comentada) ---
  # Esta regla está comentada porque la regla anterior con la bandera [L] (Last)
  # impide que se ejecute. Si se necesita, debe ser re-evaluada y colocada correctamente.
  # RewriteCond %{REQUEST_FILENAME}\.php -f
  # RewriteRule ^(.*)$ $1.php [NC,L]

</IfModule>