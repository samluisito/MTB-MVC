function fntView(c){$("#modalpedido").modal("show")}let tablePedidos,rowTable="",divLoading=document.querySelector("#divLoading");document.addEventListener("DOMContentLoaded",function(){document.querySelector("#tablePedidos")&&tablaPedidos()});
function tablaPedidos(){tablePedidos=$("#tablePedidos").DataTable({destroy:!0,stateSave:!0,responsive:!0,search:!0,searching:!0,bProcessing:!0,iDisplayLength:25,order:[[4,"DESC"]],dom:'<"row"<"col-sm-12 col-md-4"l><"col-sm-12 col-md-4"<"dt-buttons btn-group flex-wrap"B>><"col-sm-12 col-md-4"f>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{url:"https://cdn.datatables.net/plug-ins/1.10.21/i18n/Spanish.json"},ajax:{url:base_url+"pedidos/getPedidos",dataSrc:""},columns:[{data:"idpedido"},
{data:"fecha"},{data:"transaccion"},{data:"monto"},{data:"nombre_tpago"},{data:"status"},{data:"options",searchable:!1}],columnDefs:[{className:"text-rigth align-middle",targets:[3]},{className:"text-rigth align-middle",targets:[4]},{className:"text-rigth align-middle",targets:[5]}],buttons:[{extend:"excel",text:"excel",ttleAtter:"Exportar a Excel",className:"btn btn-danger excelButton",exportOptions:{columns:[0,1,2,3,4,5]}},{extend:"pdf",text:"PDF",ttleAtter:"Exportar a PDF",className:"btn btn-primary",
exportOptions:{columns:[0,1,2,3,4,5],modifier:{search:"none"}}},{extend:"csv",text:'<i class="fas fa-file-csv"></i>  CSV',ttleAtter:"Exportar a CSV",className:"btn btn-warning m-auto",exportOptions:{columns:[0,1,2,3,4,5],modifier:{search:"none"}}}]})}
function fntVer(c){let b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",base_url+"pedidos/getTransaccion/"+c,!0);b.send();b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var a=JSON.parse(b.responseText);if(a.status){let b="";a=a.data;document.querySelector("#celCodigo").innerHTML=a.codigo;document.querySelector("#celNombre").innerHTML=a.nombre;document.querySelector("#celPrecio").innerHTML=a.precio;document.querySelector("#celStock").innerHTML=
a.stock;document.querySelector("#celCategoria").innerHTML=a.categoria;document.querySelector("#celEstado").innerHTML=a.status;document.querySelector("#celDescripcion").innerHTML=a.descripcion;if(0<a.images.length){a=a.images;for(let c=0;c<a.length;c++)b+=`<img src = "${a[c].url_image}"></img>`}document.querySelector("#celFotos").innerHTML=b;$("#modalVerCategoria").modal("show")}else Swal.fire("Error",a.msg,"error")}}}
function fntTransaccion(c){let b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c=base_url+"pedidos/getTransaccion/"+c;divLoading.style.display="flex";b.open("GET",c,!0);b.send();b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){divLoading.style.display="none";let a=JSON.parse(b.responseText);a.status?(document.querySelector("#divModalTrans").innerHTML=a.html,$("#modalReembolso").modal("show")):Swal.fire("Error",a.msg,"error");return!1}}}
function fntReembolsar(){let c=document.querySelector("#idtransaccion").value,b=document.querySelector("#txtObservacion").value;if(""==c||""==b)return Swal.fire("","por favor describe el motivo de la devolucion en el campo observacion","error"),!1;Swal.fire({title:"Hacer Reembolso?",text:"Realmente quieres hacer el reembolso",type:"warning",showCancelButton:!0,cancelButtonText:"NO",confirmButtonText:"SI estoy seguro",closeOnConfirm:!0,closeONCancel:!0},function(a){if(a){$("#modalReembolso").modal("hide");
divLoading.style.display="flex";let d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a=base_url+"pedidos/setReembolso";let e=new FormData;e.append("idtransaccion",c);e.append("observacion",b);d.open("POST",a,!0);d.send(e);d.onreadystatechange=function(){divLoading.style.display="none";if(4==d.readyState&&200==d.status){let a=JSON.parse(d.responseText);a.status?Swal.fire({title:"Debolucion Exitosa",text:a.msg,type:"info",showCancelButton:!1,cancelButtonText:"ok",confirmButtonText:"OK!",
closeOnConfirm:!0,closeONCancel:!0},function(a){window.location.reload()}):Swal.fire("Error",a.msg,"error");return!1}}}})}
function fntEditPedido(c){let b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c=base_url+"pedidos/getpedido/"+c;divLoading.style.display="flex";b.open("GET",c,!0);b.send();b.onreadystatechange=function(a){a.preventDefault();if(4==b.readyState&&200==b.status)return divLoading.style.display="none",a=JSON.parse(b.responseText),a.status?(document.querySelector("#divModal").innerHTML=a.html,$("#modalFormPedido").modal("show"),$("select").selectpicker(),fntUpdatePedido()):
Swal.fire("Error",a.msg,"error"),!1}}
function fntUpdatePedido(){let c=document.querySelector("#formUpdatePedido");c.onsubmit=function(b){b.preventDefault();if(document.querySelector("#txtTransaccion")&&(b=document.querySelector("#txtTransaccion").value,""==b))return Swal.fire("","Complete los datos para continuar","error"),!1;divLoading.style.display="flex";let a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b=base_url+"pedidos/setPedido";let d=new FormData(c);a.open("POST",b,!0);a.send(d);a.onreadystatechange=
function(){divLoading.style.display="none";if(4==a.readyState&&200==a.status){let b=JSON.parse(a.responseText);b.status?(Swal.fire("OK",b.msg,"success"),tablePedidos.ajax.reload(null,!1),$("#modalFormPedido").modal("hide"),document.querySelector("#divModal").innerHTML=""):Swal.fire("Error",b.msg,"error");return!1}}}}
function reenviarEmail(c){divLoading.style.display="flex";let b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("GET",base_url+"pedidos/reenviarEmail/"+c,!0);b.send();b.onreadystatechange=function(){divLoading.style.display="none";if(4==b.readyState&&200==b.status){let a=JSON.parse(b.responseText);a.status?Swal.fire("OK",a.msg,"success"):Swal.fire("Error",a.msg,"error");return!1}}}
function nvoPedido(){Swal.fire("PROXIMAMENTE","Por ahora no puede agregar pedidos","info")};