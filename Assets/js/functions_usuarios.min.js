document.addEventListener("DOMContentLoaded",function(){tablaUsuarios();fntRolesUsuarios()},!0);let tableUsuarios;function fntRolesUsuarios(){let b=base_url+"roles/getSelectRolesTipo",a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",b,!0);a.send();a.onreadystatechange=function(){4===a.readyState&&200===a.status&&(document.querySelector("#listRolid").innerHTML=a.responseText,document.querySelector("#listRolid").value=1)}}
function tablaUsuarios(){document.querySelector("#tableUsuarios")&&(tableUsuarios=$("#tableUsuarios").DataTable({dom:'<"row"<"col-sm-12 col-md-4"l><"col-sm-12 col-md-4"<"dt-buttons btn-group flex-wrap"B>><"col-sm-12 col-md-4"f>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',buttons:[{extend:"excel",text:"excel",ttleAtter:"Exportar a Excel",className:"btn btn-danger excelButton",exportOptions:{modifier:{search:"none"}}},{extend:"pdfHtml5",text:"PDF",ttleAtter:"Exportar a Excel",className:"btn btn-primary",
exportOptions:{modifier:{search:"none"}}},{extend:"csv",text:"CSV",ttleAtter:"Exportar a CSV",className:"btn btn-warning",exportOptions:{modifier:{search:"none"}}}],destroy:!0,aServerSide:!0,responsive:!0,scrollCollapse:!0,bProcessing:!0,iDisplayLength:10,order:[[0,"asc"]],language:{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ning\u00fan dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"\u00daltimo",sNext:"Siguiente",sPrevious:"Anterior"},oAria:{sSortAscending:": Activar para ordenar la columna de manera ascendente",sSortDescending:": Activar para ordenar la columna de manera descendente"},buttons:{copy:"Copiar",colvis:"Visibilidad"}},
ajax:{url:base_url+"usuarios/getUsuarios",dataSrc:""},columns:[{data:"idpersona"},{data:"identificacion",visible:!1,searchable:!1,all:!0},{data:"nombres"},{data:"apellidos"},{data:"telefono"},{data:"email_user"},{data:"nombrerol"},{data:"status"},{data:"options",searchable:!1,all:!0}]}))}
function setForm(){$("#modalFormUsuario").modal("show");document.querySelector("#formUsuario").onsubmit=function(b){console.log("linea: 120");b.preventDefault();b=document.querySelector("#txtIdentificacion").value;let a=document.querySelector("#txtNombre").value,d=document.querySelector("#txtApellido").value,e=document.querySelector("#txtEmail").value,c=document.querySelector("#txtTelefono").value,f=document.querySelector("#listRolid").value;document.querySelector("#txtPassword");if(""===b||""===
a||""===d||""===e||""===c||""===f)return swal.fire("atencion","todos los campos son obligatorios.","error"),!1;b=new FormData(document.querySelector("#formUsuario"));fetch(ajaxUrl=base_url+"usuarios/setUsuario",{method:"POST",body:b}).then(a=>a.json()).then(a=>{a.status?($("#modalFormUsuario").modal("hide"),swal.fire("Usuarios",a.msg,"success"),tableUsuarios.ajax.reload(null,!1)):swal.fire("Error",a.msg,"error")})}}
function nuevo(){document.querySelector("#idUsuario").value="";document.querySelector(".modal-header").classList.replace("headerUpdate","headerRegister");document.querySelector("#btnActionForm").classList.replace("btn-info","btn-primary");document.querySelector("#titleModal").innerHTML="Nuevo Usuario";document.querySelector("#formUsuario").reset();setForm()}
function fntEdit(b){document.querySelector("#titleModal").innerHTML="Actualizar Usuario";document.querySelector(".modal-header").classList.replace("headerRegister","headerUpdate");document.querySelector("#btnActionForm").classList.replace("btn-primary","btn-info");fetch(base_url+"usuarios/getUser/"+b).then(a=>a.json()).then(a=>{a.status?(document.querySelector("#idUsuario").value=a.data.idpersona,document.querySelector("#txtIdentificacion").value=a.data.identificacion,document.querySelector("#txtNombre").value=
a.data.nombres,document.querySelector("#txtApellido").value=a.data.apellidos,document.querySelector("#txtTelefono").value=a.data.telefono,document.querySelector("#txtEmail").value=a.data.email_user,document.querySelector("#listRolid").value=a.data.idrol,setForm()):swal.fire("Error",a.msg,"error")})}
function fntVer(b){fetch(base_url+"usuarios/getUser/"+b).then(a=>a.json()).then(a=>{if(a.status){let b=1===a.data.status?'<span class="bagde badge-success">Activo</option>':'<span class="badge badge-danger">Inactivo</option>';document.querySelector("#verIdentificacion").innerHTML=a.data.identificacion;document.querySelector("#verNombre").innerHTML=a.data.nombres;document.querySelector("#verApellido").innerHTML=a.data.apellidos;document.querySelector("#verTelefono").innerHTML=a.data.telefono;document.querySelector("#verEmail").innerHTML=
a.data.email_user;document.querySelector("#verTpoUser").innerHTML=a.data.nombrerol;document.querySelector("#verEstado").innerHTML=b;document.querySelector("#verFechReg").innerHTML=a.data.fechaRegistro;$("#modalVerUsuario").modal("show")}else swal.fire("Error",a.msg,"error")})}
function fntDataFiscal(){if(document.querySelector("#formDataFiscal")){let b=document.querySelector("#formDataFiscal");b.onsubmit=function(a){a.preventDefault();a=document.querySelector("#txtNit").value;var d=document.querySelector("#txtNombreFiscal").value;let e=document.querySelector("#txtDirFiscal").value;if(""===a||""===d||""===e)return swal.fire("atencion","todos los campos con ( * ) son obligatorios.","error"),!1;let c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
a=base_url+"usuarios/putdatfiscal";d=new FormData(b);c.open("POST",a,!0);c.send(d);c.onreadystatechange=function(){if(4==c.readyState&&200===c.status){let a=JSON.parse(c.responseText);a.status?($("#modalFormPerfil").modal("hide"),swal.fire({title:"",text:a.msg,type:"success",confirmButtonText:"Aceptar",closeOnConfirm:!1},function(a){a&&location.reload()})):swal.fire("Error",a.msg,"error")}}}}}
function fntDel(b){swal.fire({title:"Eliminar Usuario",text:"Quieres eliminar el Al Usuario?",type:"question",showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"Si, Eliminar",cancelButtonText:"No, Cancelar",closeOnConfirm:!1,closeOnCancel:!0},a=>{a&&fetch(base_url+"usuarios/delUser/",{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:"idUsuario="+b}).then(a=>a.json()).then(a=>{a.status?(swal.fire("eliminar!",a.msg,"success"),tableUsuarios.ajax.reload(null,!1)):
swal.fire("Atencio!",a.msg,"error")})})};