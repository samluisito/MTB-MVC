document.addEventListener("DOMContentLoaded",function(){getShipping()});document.querySelector("#condiciones")&&document.querySelector("#condiciones").addEventListener("click",function(){this.checked?document.querySelector("#btnRegistrarme").classList.remove("notBlock"):document.querySelector("#btnRegistrarme").classList.add("notBlock")});
function actualizarTotalDeCarrito(a,b){document.querySelectorAll(".shipping_monto").forEach(function(a){a.innerHTML="";a.innerHTML="$ "+number_format(b,2,",",".")});document.querySelectorAll(".total_monto").forEach(function(c){c.innerHTML="";c.innerHTML="$ "+number_format(a+b,2,",",".")});document.querySelectorAll(".selctmethodpago").forEach(a=>a.checked=!1);document.querySelectorAll(".metodopagodiv").forEach(a=>a.classList.add("notBlock"))}
function getShipping(){if("retiro"==document.querySelector("#metodoEntregaSelect").value){let a=new Number(cleanFormatNumero(document.querySelector(".subtotal_monto").innerHTML));actualizarTotalDeCarrito(a,0)}else if("entrega"==document.querySelector("#metodoEntregaSelect").value){let a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open("GET",base_url+"carrito/getShipping",!0);a.send();a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=JSON.parse(a.responseText);
let c=cleanFormatNumero(document.querySelector(".subtotal_monto").innerHTML);b=cleanFormatNumero(b.shipping);actualizarTotalDeCarrito(c,b)}}}}
document.querySelector(".selctMetodoEntrega")&&document.querySelectorAll(".selctMetodoEntrega").forEach(function(a){a.addEventListener("click",function(){document.querySelectorAll(".metodoEntregaDiv").forEach(a=>{a.classList.add("notBlock")});document.querySelector("#"+this.value+"Div").classList.remove("notBlock");document.querySelector("#metodoEntregaSelect").value=this.value;getShipping()})});
document.querySelector(".selctmethodpago")&&document.querySelectorAll(".selctmethodpago").forEach(function(a){a.addEventListener("click",function(){document.querySelectorAll(".metodopagodiv").forEach(a=>{a.classList.add("notBlock")});"mp"==this.value?crearPreferenciaMP():"";"pp"==this.value?createButtonPayPal():"";document.querySelector("#"+this.value+"Div").classList.remove("notBlock");document.querySelector("#idTPseleccionado").value=this.value})});
document.querySelector("#txtDireccion")&&document.querySelector("#txtDireccion").addEventListener("keyup",function(){fntViewPago()});document.querySelector("#txtCiudad")&&document.querySelector("#txtCiudad").addEventListener("keyup",function(){fntViewPago()});function fntViewPago(){document.querySelector("#txtDireccion");document.querySelector("#txtCiudad");document.querySelector("#divMetodoPago ").classList.remove("notBlock")}
document.querySelector("#ceButton")&&document.querySelector("#ceButton").addEventListener("click",function(a){a.preventDefault();a=document.querySelector("#idTPseleccionado").value;let b=cleanFormatNumero(document.querySelector(".subtotal_monto").innerHTML),c=cleanFormatNumero(document.querySelector(".shipping_monto").innerHTML),h=cleanFormatNumero(document.querySelector(".total_monto").innerHTML);var g=document.querySelector("#formEenvioRetiro");let d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),
e=base_url+"carrito/procesarVentaCE";g=new FormData(g);g.append("tpopago",a);g.append("subtotal_monto",b);g.append("shipping_monto",c);g.append("total_monto",h);d.open("POST",e,!0);d.send(g);d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){let a=JSON.parse(d.responseText);a.status?swal({title:"Pedido Exitoso",text:a.msg,icon:"info",buttons:"OK",dangerMode:!0}).then(a=>{window.location.href=base_url+"carrito/confirmarpedido"}):swal("Error",a.msg,"error")}}},!1);
function validarTranferenciaId(a){fetch(base_url+"carrito/validaridtransferencia/"+a).then(a=>a.json()).then(a=>retornar=a)}
document.querySelector("#tbButton")&&document.querySelector("#tbButton").addEventListener("click",function(a){a.preventDefault();a=document.querySelector("#idTranfer").value.replace(/\s+/g,"");let b=document.querySelector("#idTPseleccionado").value,c=cleanFormatNumero(document.querySelector(".subtotal_monto").innerHTML),h=cleanFormatNumero(document.querySelector(".shipping_monto").innerHTML),g=cleanFormatNumero(document.querySelector(".total_monto").innerHTML);if(""==a)return swal("Por Favor","ingrese el numero de comprobante",
"error"),!1;{var d=document.querySelector("#formEenvioRetiro");let e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),f=base_url+"carrito/procesarventatb";d=new FormData(d);d.append("transaccionid",a);d.append("tpopago",b);d.append("subtotal_monto",c);d.append("shipping_monto",h);d.append("total_monto",g);e.open("POST",f,!0);e.send(d);e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){let a=JSON.parse(e.responseText);a.status?(window.location.href=base_url+
"carrito/confirmarpedido",swal({title:"Pedido Exitoso",text:a.msg,icon:"info",buttons:"OK",dangerMode:!0}).then(a=>{window.location.href=base_url+"carrito/confirmarpedido"})):swal("Error",a.msg,"error")}}}},!1);
function createButtonPayPal(){document.getElementById("paypal-button-container").innerHTML="";let a=cleanFormatNumero(document.querySelector(".total_monto").innerHTML);paypal.Buttons({createOrder:function(b,c){return c.order.create({purchase_units:[{amount:{value:a},description:"Compra de Articulos por $ "+a}]})},onApprove:function(b,c){return c.order.capture().then(function(b){let c=document.querySelector("#idTPseleccionado").value,d=cleanFormatNumero(document.querySelector(".subtotal_monto").innerHTML),
e=cleanFormatNumero(document.querySelector(".shipping_monto").innerHTML);var f=document.querySelector("#formEenvioRetiro");let k=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),h=base_url+"carrito/procesarventapp";f=new FormData(f);f.append("tpopago",c);f.append("datapay",JSON.stringify(b));f.append("subtotal_monto",d);f.append("shipping_monto",e);f.append("total_monto",a);k.open("POST",h,!0);k.send(f);k.onreadystatechange=function(){if(4==k.readyState&&200==k.status){let a=
JSON.parse(k.responseText);a.status?window.location=base_url+"carrito/confirmarpedido":swal("Error",a.msg,"error")}}})}}).render("#paypal-button-container")}function createCheckoutButton(a){var b=document.createElement("script");b.src="https://www.mercadopago.com.ar/integrations/v1/web-payment-checkout.js";b.type="text/javascript";b.dataset.preferenceId=a;document.getElementById("mpButtonContainer").innerHTML="";document.getElementById("mpButtonContainer").appendChild(b)}
function createCheckoutButtonV2(a){document.getElementById("mpButtonContainer").innerHTML="";mp.checkout({preference:{id:a},render:{container:"#mpButtonContainer",label:" Pagar con MercadoPago "}})}
function crearPreferenciaMP(){let a=document.querySelector("#idTPseleccionado").value;cleanFormatNumero(document.querySelector(".subtotal_monto").innerHTML);cleanFormatNumero(document.querySelector(".shipping_monto").innerHTML);cleanFormatNumero(document.querySelector(".total_monto").innerHTML);var b=document.querySelector("#formEenvioRetiro");let c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),h=base_url+"carrito/prefereciaMP";b=new FormData(b);b.append("tpopago",
a);c.open("POST",h,!0);c.send(b);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){let a=JSON.parse(c.responseText);createCheckoutButtonV2(a.id)}}};