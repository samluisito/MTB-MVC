let tableEntradas;let divLoading=document.querySelector("#divLoading");let tinymece;document.addEventListener("DOMContentLoaded",function(){tablaEntradas();pluginsEntradas()});
function fntInputFile(){let inputUploadfile=document.querySelectorAll(".inputUploadfile");inputUploadfile.forEach(function(inputUploadfile){inputUploadfile.addEventListener("change",function(){let idEntrada=document.querySelector("#idEntrada").value;let nombreEntrada=document.querySelector("#txtTitulo").value;let parentId=this.parentNode.getAttribute("id");let idFile=this.getAttribute("id");let uploadFoto=document.querySelector("#"+idFile).value;let fileimg=document.querySelector("#"+idFile).files;
let prevImg=document.querySelector("#"+parentId+" .prevImage");let nav=window.URL||window.webkitURL;if(uploadFoto!=""){let type=fileimg[0].type;let name=fileimg[0].name;if(type!="image/jpeg"&&type!="image/jpg"&&type!="image/png"){prevImg.innerHTML="Archivo no v\u00e1lido";uploadFoto.value="";return false}else{let objeto_url=nav.createObjectURL(this.files[0]);prevImg.innerHTML=`<img class="loading" src="${base_url}Assets/images/loading.svg" >`;let request=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");
let ajaxUrl=base_url+"/ABlog/setImage";let formData=new FormData;formData.append("identrada",idEntrada);formData.append("nombreEntrada",nombreEntrada);formData.append("foto",this.files[0]);request.open("POST",ajaxUrl,true);request.send(formData);request.onreadystatechange=function(){if(request.readyState!=4)return;if(request.status==200){let objData=JSON.parse(request.responseText);if(objData.status){prevImg.innerHTML=`<img src="${objeto_url}">`;document.querySelector("#"+parentId+" .btnDeleteImage").setAttribute("imgname",
objData.imgname);document.querySelector("#"+parentId+" .btnUploadfile").classList.add("notBlock");document.querySelector("#"+parentId+" .btnDeleteImage").classList.remove("notBlock")}else swal("Error",objData.msg,"error")}}}}})})}
function fntDelItem(element){let nameImg=document.querySelector(element+" .btnDeleteImage").getAttribute("imgname");let request=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");let ajaxUrl=base_url+"/ABlog/delFile";let idEntrada=document.querySelector("#idEntrada").value;let formData=new FormData;formData.append("identrada",idEntrada);formData.append("file",nameImg);request.open("POST",ajaxUrl,true);request.send(formData);request.onreadystatechange=function(){if(request.readyState!=
4)return;if(request.status==200){let objData=JSON.parse(request.responseText);if(objData.status){let itemRemove=document.querySelector(element);itemRemove.parentNode.removeChild(itemRemove)}else swal("Error",objData.msg,"error")}}}
function pluginsEntradas(){tinymce.init({selector:"#txtTexto",width:"100%",plugins:["lists","advlist","charmap","code","emoticons","fullscreen","help","hr","image","imagetools","insertdatetime","link","media","nonbreaking","pagebreak","paste","preview","print","table","visualblocks ","visualchars ","wordcount "],toolbar1:" undo "+" redo |"+" fontselect "+" fontsizeselect "+" formatselect "+" lineheight "+" indent "+" outdent |"+" alignleft "+" aligncenter "+" alignright "+" alignjustify "+" alignnone |"+
" blockquote |"+" backcolor "+" forecolor |"+" bold "+" italic "+" underline "+" strikethrough |"+" subscript "+" superscript |"+" copy "+" cut "+" paste |"+" removeformat |"+" numlist bullist |"+" charmap |"+" code |"+" emoticons |"+" fullscreen |"+" image |"+" link |"+" media |"+" nonbreaking |"+" hr |"+" pagebreak |"+" paste pastetext |"+"table | "+"visualblocks | "+"visualchars | "+" help |"+"",menubar:"file edit insert view format table tools help",fullscreen_native:false,height:"400",statubar:true,
a11y_advanced_options:true,image_advtab:true,imagetools_toolbar:"rotateleft rotateright | flipv fliph | editimage imageoptions",default_link_target:"_blank",link_context_toolbar:true,link_title:true,media_live_embeds:true,pagebreak_separator:"\x3c!-- salto de pagina --\x3e",browser_spellcheck:true,contextmenu:false,fontsize_formats:"6pt 8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt",block_formats:"Paragraph=p; Header 3=h3; Header 4=h4; Header 5=h5; Header 6=h6",style_formats:[{title:"Headings",items:[{title:"Heading 3",
format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",format:"bold"},{title:"Italic",format:"italic"},{title:"Underline",format:"underline"},{title:"Strikethrough",format:"strikethrough"},{title:"Superscript",format:"superscript"},{title:"Subscript",format:"subscript"},{title:"Code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",
format:"div"},{title:"Pre",format:"pre"}]},{title:"Align",items:[{title:"Left",format:"alignleft"},{title:"Center",format:"aligncenter"},{title:"Right",format:"alignright"},{title:"Justify",format:"alignjustify"}]}],theme:"silver",language:"es",branding:false});if(document.querySelector("#listCategoria")){let ajaxUrl=base_url+"categorias/getSelectCategorias/blog";let request=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");request.open("GET",ajaxUrl,true);request.send();
request.onreadystatechange=function(){if(request.readyState==4&&request.status==200){document.querySelector("#listCategoria").innerHTML=request.responseText;$("#listCategoria").selectpicker("render")}}}if(document.querySelector(".btnAddImage")){let btnAddImage=document.querySelector(".btnAddImage");btnAddImage.onclick=function(e){let key=Date.now();let newElement=document.createElement("div");newElement.id="div"+key;newElement.innerHTML=`<div class="prevImage " >
                                   </div>
                                   <input type="file" name="foto" id="img${key}" class="inputUploadfile">
                                   <label for="img${key}" class="btnUploadfile"><i class="fa fa-upload "></i></label>
                                   <button class="btnDeleteImage notBlock" type="button" onclick="fntDelItem('#div${key}')"><i class="fa fa-trash"></i></button>`;document.querySelector("#containerImages").appendChild(newElement);document.querySelector("#div"+key+" .btnUploadfile").click();fntInputFile()}}}
function tablaEntradas(){tableEntradas=$("#tableEntradas").DataTable({"destroy":false,"stateSave":true,"responsive":true,"paging":true,"search":true,"searching":true,"Processing":true,"info":true,"paging":true,"iDisplayLength":25,"ordering":true,"order":[[0,"desc"]],"language":{"sProcessing":"Procesando...","sLengthMenu":"Mostrar _MENU_ registros","sZeroRecords":"No se encontraron resultados","sEmptyTable":"Ning\u00fan dato disponible en esta tabla","sInfo":"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
"sInfoEmpty":"Mostrando registros del 0 al 0 de un total de 0 registros","sInfoFiltered":"(filtrado de un total de _MAX_ registros)","sInfoPostFix":"","sSearch":"Buscar:","sUrl":"","sInfoThousands":",","sLoadingRecords":"Cargando...","oPaginate":{"sFirst":"Primero","sLast":"\u00daltimo","sNext":"Siguiente","sPrevious":"Anterior"},"oAria":{"sSortAscending":": Activar para ordenar la columna de manera ascendente","sSortDescending":": Activar para ordenar la columna de manera descendente"},"buttons":{"copy":"Copiar",
"colvis":"Visibilidad"}},"ajax":{url:base_url+"ABlog/getEntradas",dataSrc:""},"columns":[{"data":"img_entrada"},{"data":"titulo"},{"data":"descripcion"},{"data":"autor"},{"data":"categoria"},{"data":"options","searchable":false}],"columnDefs":[{"className":"text-center","targets":[0]},{"className":"text-rigth","targets":[2]},{"className":"text-center","targets":[5]}],dom:"lBfrtilp",buttons:[{extend:"excel",text:"excel",ttleAtter:"Exportar a Excel",className:"btn btn-danger excelButton",exportOptions:{modifier:{search:"none"}}},
{extend:"pdf",text:"PDF",ttleAtter:"Exportar a PDF",className:"btn btn-primary",exportOptions:{modifier:{search:"none"}}},{extend:"csv",text:"CSV",ttleAtter:"Exportar a CSV",className:"btn btn-warning",exportOptions:{modifier:{search:"none"}}}]})}
function nvaEntrada(){document.querySelector("#idEntrada").value="";document.querySelector(".modal-header").classList.replace("headerUpdate","headerRegister");document.querySelector("#btnActionForm").classList.replace("btn-info","btn-primary");document.querySelector("#titleModal").innerHTML="Nueva Entrada";document.querySelector("#btnText").innerHTML="Guardar";document.querySelector("#formEntrada").reset();document.querySelector("#containerGallery").classList.add("notBlock");document.querySelector("#containerImages").innerHTML=
"";document.querySelector("#pagina_prev").innerHTML="";document.querySelector("#pagina_prox").innerHTML="";document.querySelector("#pagina_poss").innerHTML="";formEntrada()}
function fntEdit(id){document.querySelector("#titleModal").innerHTML="Actualizar Entrada";document.querySelector(".modal-header").classList.replace("headerRegister","headerUpdate");document.querySelector("#btnActionForm").classList.replace("btn-primary","btn-info");document.querySelector("#btnText").innerHTML="Actualizar";document.querySelector("#containerGallery").classList.remove("notBlock");let request=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");let ajaxUrlUserId=
base_url+"ABlog/getEntrada/"+id;request.open("GET",ajaxUrlUserId,true);request.send();request.onreadystatechange=function(){if(request.readyState==4&&request.status==200){let objData=JSON.parse(request.responseText);if(objData.status){console.log(objData);let htmlImage="";let objEntrada=objData.data;document.querySelector("#idEntrada").value=objEntrada.identrada;document.querySelector("#txtTitulo").value=objEntrada.titulo;document.querySelector("#txtDescripcion").value=objEntrada.descripcion;document.querySelector("#txtTexto").value=
objEntrada.txt_entrada;document.querySelector("#txtTags").value=objEntrada.tags;tinymce.activeEditor.setContent(objEntrada.txt_entrada);document.querySelector("#listCategoria").value=objEntrada.categoriaid;$("#listCategoria").selectpicker("render");document.querySelector("#listStatus").value=objEntrada.status;$("#listStatus").selectpicker("render");objData.data.prev==0?document.querySelector("#pagina_prev").innerHTML="":document.querySelector("#pagina_prev").innerHTML='<button class="page-item page-link pull-left" onClick="fntEdit('+
objEntrada.prev+')" >\u00ab</button>';objData.data.prox==0?document.querySelector("#pagina_prox").innerHTML="":document.querySelector("#pagina_prox").innerHTML='<button class="page-item page-link pull-right" onClick="fntEdit('+objEntrada.prox+')" >\u00ab</button>';document.querySelector("#pagina_poss").innerHTML='<span class="text-primary" >'+objEntrada.posicion+"</span>";if(objEntrada.images.length>0){let objProImages=objEntrada.images;for(let p=0;p<objProImages.length;p++){let key=Date.now()+p;
htmlImage+=`<div id="div${key}">
                                        <div class="prevImage">
                                            <img src="${objProImages[p].url_image}"></img>
                                        </div>

                                        <input type="file" name="foto" id="img${key}" class="inputUploadfile">
                                        <label for="img${key}" class="btnUploadfile notBlock"><i class="fa fa-upload "></i></label>

                                        <button class="btnDeleteImage" type="button" onclick="fntDelItem('#div${key}')" imgname="${objProImages[p].img}">
                                        <i class="fa fa-trash"></i>
                                        </button>
                                    </div>`}}document.querySelector("#containerImages").innerHTML=htmlImage;document.querySelector("#containerGallery").classList.remove("notBlock");formEntrada()}else swal("Error",objData.msg,"error")}}}
function formEntrada(){$("#modalFormEntrada").modal("show");let formEntrada=document.querySelector("#formEntrada");formEntrada.onsubmit=function(e){e.preventDefault();let txtTitulo=document.querySelector("#txtTitulo").value;let txtDescripcion=document.querySelector("#txtDescripcion").value;let txtTexto=document.querySelector("#txtTexto").value;if(txtTitulo==""||txtDescripcion==""||txtTexto==""){swal("atencion","todos los campos son obligatorios.","error");return false}tinymce.triggerSave();let request=
window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");let ajaxUrl=base_url+"ABlog/setEntrada";let formData=new FormData(formEntrada);request.open("POST",ajaxUrl,true);request.send(formData);request.onreadystatechange=function(){divLoading.style.display="none";if(request.readyState==4&&request.status==200){let objData=JSON.parse(request.responseText);if(objData.status){swal("Entradas",objData.msg,"success");document.querySelector("#idEntrada").value=objData.identrada;document.querySelector("#containerGallery").classList.remove("notBlock");
tableEntradas.ajax.reload(null,false)}else swal("Error",objData.msg,"error")}}}}
function fntVer(id){let idProd=id;let request=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");let ajaxUrlUserId=base_url+"entradas/getEntrada/"+idProd;request.open("GET",ajaxUrlUserId,true);request.send();request.onreadystatechange=function(){if(request.readyState==4&&request.status==200){let objData=JSON.parse(request.responseText);if(objData.status){let htmlImage="";let objEntrada=objData.data;let status=objEntrada.status==1?'<span class="bagde badge-success">Activo</option>':
'<span class="badge badge-danger">Inactivo</option>';document.querySelector("#celCodigo").innerHTML=objEntrada.codigo;document.querySelector("#celNombre").innerHTML=objEntrada.nombre;document.querySelector("#celPrecio").innerHTML=objEntrada.precio;document.querySelector("#celStock").innerHTML=objEntrada.stock;document.querySelector("#celCategoria").innerHTML=objEntrada.categoria;document.querySelector("#celEstado").innerHTML=objEntrada.status;document.querySelector("#celDescripcion").innerHTML=objEntrada.descripcion;
if(objEntrada.images.length>0){let objProImages=objEntrada.images;for(let p=0;p<objProImages.length;p++)htmlImage+=`<img src = "${objProImages[p].url_image}"></img>`}document.querySelector("#celFotos").innerHTML=htmlImage;$("#modalVerEntrada").modal("show")}else swal("Error",objData.msg,"error")}}}
function fntDel(id){let idEntrada=id;swal({title:"Eliminar entrada",text:"Quieres eliminar el Entrada?",type:"warning",showCancelButton:true,showConfirmButton:true,cancelButtonText:"No, Cancelar",closeOnConfirm:false,coseOnCancel:true},function(isConfirm){if(isConfirm){let request=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");let ajaxUrlDel=base_url+"entradas/delEntrada/";let arrData="identrada="+idEntrada;request.open("POST",ajaxUrlDel,true);request.setRequestHeader("Content-type",
"application/x-www-form-urlencoded");request.send(arrData);request.onreadystatechange=function(){if(request.readyState==4&&request.status==200){let objData=JSON.parse(request.responseText);if(objData.status){swal("eliminar!",objData.msg,"success");tableEntradas.ajax.reload(null,false)}else swal("Atencio!",objData.msg,"error")}}}})};