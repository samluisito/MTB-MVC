let tableProductos;let tinymcel;let choiseListCategoria;let choiseFiltroListCategoria;let choiseListProveedor;let dolarHoy=document.getElementById("dolarHoy").value;document.addEventListener("DOMContentLoaded",()=>{opcionesFiltroCategoria();filtrarTablaProductos();pluginsProductos()});let URL=window.URL||window.webkitURL;let file=document.getElementById("foto");let image=document.getElementById("img-original");let btncrop=document.getElementById("btn-crop");let cropper=null;let img_type="";
let img_name="";let ancho=600;let alto=600;let relacionAspecto=.81/1;let parentId="";function dataURLtoFile(dataurl,filename){let arr=dataurl.split(","),mime=arr[0].match(/:(.*?);/)[1],bstr=atob(arr[1]),n=bstr.length,u8arr=new Uint8Array(n);while(n--)u8arr[n]=bstr.charCodeAt(n);return new File([u8arr],filename,{type:mime})}
function alertFoto(mensaje){let prevImg=document.querySelector("#"+parentId+" .prevImage");prevImg.innerHTML='<p class="errorArchivo">'+mensaje+".</p>";image.src="";cropper=null;return false}$("#div-modal-recorte").on("shown.bs.modal",function(){cropper=new Cropper(image,{minCropBoxWidth:ancho*.3,minCropBoxHeight:alto*.3,zoomOnWheel:false,zoomable:false,zoomOnTouch:false,preview:"#div-preview",viewMode:1})}).on("hidden.bs.modal",function(){cropper.destroy();image.src="";cropper=null});
btncrop.addEventListener("click",function(){let imgrecorte=cropper.getCroppedCanvas().toDataURL(img_type);let prevImg=document.querySelector("#"+parentId+" .prevImage");prevImg.innerHTML=`<img class="loading" src="${base_url}Assets/images/loading.svg" >`;$("#div-modal-recorte").modal("hide");let myImage=new Image;myImage.src=imgrecorte;let imgFile=dataURLtoFile(myImage.src,img_name);imgrecorte="";let idProducto=document.querySelector("#idProducto").value;let nombreProducto=document.querySelector("#txtNombre").value;
let formData=new FormData;formData.append("idproducto",idProducto);formData.append("nombreProducto",nombreProducto);formData.append("foto",imgFile);fetch(base_url+"/Productos/setImage",{method:"POST",body:formData}).then(objData=>objData.json()).then(objData=>{if(objData.status){let key=objData.data.id;let html=contDivImg(key,objData.img_name,myImage.src,myImage.src);let elemento=document.querySelector("#"+parentId);elemento.innerHTML=html;elemento.setAttribute("data-forden",objData.data.posicion);
elemento.setAttribute("id",`div${key}`);filtrarTablaProductos();ligthbbox_reload();tableProductos.ajax.reload(null,false)}else Swal.fire("Error",objData.msg,"error")}).catch(err=>window.alert(err))});
function fntInputFile(){let inputUploadfile=document.querySelectorAll(".inputUploadfile");inputUploadfile.forEach(function(inputUploadfile){inputUploadfile.addEventListener("change",function(e){parentId=this.parentNode.getAttribute("id");let files=e.target.files;if(files&&files.length>0){img_type=files[0]["type"];img_name=files[0]["name"];let tpo_img_correcto=img_type!=="image/jpeg."?1:img_type!=="image/jpg."?1:img_type!=="image/png."?1:img_type!=="image/webp."?1:0;if(!tpo_img_correcto)alertFoto("El archivo debe de ser tipo: .jpg .jpeg .png");
let objfile=files[0];if(URL)image.src=URL.createObjectURL(objfile);else if(FileReader){let reader=new FileReader;reader.onload=()=>image.src=reader.result;reader.readAsDataURL(objfile)}image.onload=function(){if(image.width<ancho||alto>image.height)alertFoto("Imagen axtual: "+image.width+"x"+image.height+"px, minimo: 600x600px, ideal mayor a 1200x1200px");else $("#div-modal-recorte").modal("show")}}})})}
function fntDelItem(element){let nameImg=document.querySelector(element+" .btnDeleteImage").getAttribute("img_name");let idProducto=document.querySelector("#idProducto").value;let formData=new FormData;formData.append("idproducto",idProducto);formData.append("file",nameImg);fetch(base_url+"/Productos/delFile",{method:"POST",body:formData}).then(objData=>objData.json()).then(objData=>{if(objData.status){let itemRemove=document.querySelector(element);itemRemove.parentNode.removeChild(itemRemove);objData.data;
let count=objData.data.length;for(let p=0;p<count;p++){let element=document.querySelector(`#div${objData.data[p].id}`);element.setAttribute("data-forden",objData.data[p].posicion)}filtrarTablaProductos();tableProductos.ajax.reload(null,false)}else Swal.fire("Error",objData.msg,"error")}).catch(e=>console.log(e))}document.getElementById("costoPeso").onchange=()=>calcular("costoPeso","costoUSD","d",2);document.getElementById("costoPeso").onkeyup=()=>calcular("costoPeso","costoUSD","d",2);
document.getElementById("costoUSD").onchange=()=>calcular("costoUSD","costoPeso","m",0);document.getElementById("costoUSD").onkeyup=()=>calcular("costoUSD","costoPeso","m",0);document.getElementById("precioUSD").onchange=()=>calcular("precioUSD","precioPeso","m",0);document.getElementById("precioUSD").onkeyup=()=>calcular("precioUSD","precioPeso","m",0);document.getElementById("precioPeso").onchange=()=>calcular("precioPeso","precioUSD","d",2);
document.getElementById("precioPeso").onkeyup=()=>calcular("precioPeso","precioUSD","d",2);document.getElementById("porcentaje").onchange=()=>sumarPorcentaje();document.getElementById("porcentaje").onkeyup=()=>sumarPorcentaje();document.getElementById("ofertaPesos").onchange=()=>calcular("ofertaPesos","ofertaDolar","d",2);document.getElementById("ofertaPesos").onkeyup=()=>calcular("ofertaPesos","ofertaDolar","d",2);
document.getElementById("ofertaDolar").onchange=()=>calcular("ofertaDolar","ofertaPesos","m",0);document.getElementById("ofertaDolar").onkeyup=()=>calcular("ofertaDolar","ofertaPesos","m",0);function calcular(origen,destino,operador,decimales){let precio=document.getElementById(origen).value;let valor=operador==="d"?precio/dolarHoy:precio*dolarHoy;document.getElementById(destino).value=parseFloat(valor).toFixed(decimales);calcularDiferencia();calcularPorciento()}
function sumarPorcentaje(){let costo=parseFloat(document.getElementById("costoUSD").value);let porciento=parseFloat(document.getElementById("porcentaje").value);if(costo>0&&porciento>0){let montoPorciento=costo/100*porciento+costo;document.getElementById("precioUSD").value=parseFloat(montoPorciento).toFixed(2);document.getElementById("precioPeso").value=parseFloat(montoPorciento*dolarHoy).toFixed(0);calcularDiferencia()}}
function calcularPorciento(){let costo=document.getElementById("costoUSD").value;let precio=document.getElementById("precioUSD").value;let porcentaje=(precio-costo)/costo*100;if(costo>0&&precio>0)document.getElementById("porcentaje").value=parseFloat(porcentaje).toFixed(2)}
function calcularDiferencia(){let costo=document.getElementById("costoUSD").value;let precio=document.getElementById("precioUSD").value;let costop=document.getElementById("costoPeso").value;let preciop=document.getElementById("precioPeso").value;if(costo>0&&precio>0)document.getElementById("diferenciaDolar").value=parseFloat(precio-costo).toFixed(2);if(costop>0&&preciop>0)document.getElementById("diferenciaPeso").value=parseFloat(preciop-costop).toFixed(0)}
function pluginsProductos(){tinymce.init({selector:"#txtDescripcion",width:"100%",plugins:["lists","advlist","charmap","code","emoticons","help","hr","insertdatetime","nonbreaking","visualblocks ","visualchars ","wordcount "],toolbar1:" undo "+" redo |"+" fontselect "+" fontsizeselect "+" formatselect "+" lineheight "+" indent "+" outdent |"+" alignleft "+" aligncenter "+" alignright "+" alignjustify "+" backcolor "+" forecolor |"+" bold "+" italic "+" underline "+" copy "+" cut "+" paste |"+" removeformat |"+
" numlist bullist |"+" emoticons |"+" hr |"+"table | "+" help |"+"",menubar:"file edit insert view format table tools help",fullscreen_native:false,height:"300",statubar:true,a11y_advanced_options:true,image_advtab:true,imagetools_toolbar:"rotateleft rotateright | flipv fliph | editimage imageoptions",default_link_target:"_blank",link_context_toolbar:true,link_title:true,media_live_embeds:true,pagebreak_separator:"\x3c!-- salto de pagina --\x3e",browser_spellcheck:true,contextmenu:false,fontsize_formats:"6pt 8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt",
block_formats:"Paragraph=p; Header 3=h3; Header 4=h4; Header 5=h5; Header 6=h6",style_formats:[{title:"Headings",items:[{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",format:"bold"},{title:"Italic",format:"italic"},{title:"Underline",format:"underline"},{title:"Strikethrough",format:"strikethrough"},{title:"Superscript",format:"superscript"},{title:"Subscript",format:"subscript"},
{title:"Code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Align",items:[{title:"Left",format:"alignleft"},{title:"Center",format:"aligncenter"},{title:"Right",format:"alignright"},{title:"Justify",format:"alignjustify"}]}],theme:"silver",language:"es",branding:false});tinymce.init({selector:"#txtDetalle",width:"100%",plugins:["lists","advlist","charmap","code","emoticons",
"fullscreen","help","hr","insertdatetime","link","nonbreaking","pagebreak","paste","searchreplace","table","visualblocks ","visualchars ","wordcount "],toolbar1:" undo "+" redo |"+" fontselect "+" fontsizeselect "+" formatselect "+" lineheight "+" indent "+" outdent |"+" alignleft "+" aligncenter "+" alignright "+" alignjustify "+" alignnone |"+" backcolor "+" forecolor |"+" bold "+" italic "+" underline "+" strikethrough |"+" subscript "+" superscript |"+" copy "+" cut "+" paste |"+" removeformat |"+
" numlist bullist |"+" charmap |"+" code |"+" emoticons |"+" fullscreen |"+" image |"+" link |"+" media |"+" nonbreaking |"+" hr |"+" pagebreak |"+"table | "+"visualblocks | "+"visualchars | "+" help |"+"",menubar:"file edit insert view format table tools help",fullscreen_native:false,height:"300",statubar:true,a11y_advanced_options:true,image_advtab:true,imagetools_toolbar:"rotateleft rotateright | flipv fliph | editimage imageoptions",default_link_target:"_blank",link_context_toolbar:true,link_title:true,
media_live_embeds:true,pagebreak_separator:"\x3c!-- salto de pagina --\x3e",browser_spellcheck:true,contextmenu:false,fontsize_formats:"6pt 8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt",block_formats:"Paragraph=p; Header 3=h3; Header 4=h4; Header 5=h5; Header 6=h6",style_formats:[{title:"Headings",items:[{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",format:"bold"},{title:"Italic",
format:"italic"},{title:"Underline",format:"underline"},{title:"Strikethrough",format:"strikethrough"},{title:"Superscript",format:"superscript"},{title:"Subscript",format:"subscript"},{title:"Code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Align",items:[{title:"Left",format:"alignleft"},{title:"Center",format:"aligncenter"},{title:"Right",format:"alignright"},{title:"Justify",
format:"alignjustify"}]}],theme:"silver",language:"es",branding:false});$(document).on("focusin",function(e){if($(e.target).closest(".tox-dialog").length)e.stopImmediatePropagation()});if(document.querySelector("#listCategoria"))fetch(base_url+"categorias/getSelectCategoriasChoise").then(res=>res.json()).then(res=>{let opciones=document.getElementById("listCategoria");choiseListCategoria=new Choices(opciones,{shouldSort:false,searchPlaceholderValue:"Buscar Categoria",itemSelectText:"<-",choices:res});
choiseListCategoria.setChoiceByValue(0)});if(document.querySelector("#listProveedor"))fetch(base_url+"productos/getSelectProveedoresChoise").then(res=>res.json()).then(res=>{let opciones=document.getElementById("listProveedor");choiseListProveedor=new Choices(opciones,{shouldSort:false,searchPlaceholderValue:"Buscar proveedor",itemSelectText:"<-",choices:res})});if(document.querySelector(".btnAddImage")){let btnAddImage=document.querySelector(".btnAddImage");btnAddImage.onclick=function(e){let key=
Date.now();let newElement=document.createElement("div");newElement.id="div"+key;newElement.innerHTML=contDivImg(key);document.querySelector("#containerImages").appendChild(newElement);document.querySelector("#div"+key+" .btnUploadfile").click();fntInputFile()}}}let lightbox;let lightboxDesc;let lightboxvideo;function ligthbbox_reload(){lightbox=GLightbox({selector:".image-popup",title:false})}
function contDivImg(key,img_name=null,img_url=null,thumb_url=null,posicion=null){return`${posicion===null?"":`<div id="div${key}" data-forden="${posicion}">`}
            <div class="botonPrevProx row mx-0">
                  <button type="button" class="btn btn-outline-dark btn-sm col-6" onClick="fotoMovePos('-')"><i class="fas fa-arrow-left"></i></button>
                  <button type="button" class="btn btn-outline-dark btn-sm col-6" onClick="fotoMovePos('+')"><i class="fas fa-arrow-right"></i></button>
            </div>          
              <div class="prevImage ${img_url===null?'"':`prod-pic-rel" style="background: url(${img_url})"`}>
              ${img_url===null?"":`<a href="${img_url}" class="prod-scale-img thumb preview-thumb image-popup">
                                            <img src="${thumb_url}" class="img-fluid " alt="work-thumbnail"> 
                                          </a>`}
            </div>
            <input type="file" name="foto" id="img${key}" class="inputUploadfile">
            <label for="img${key}" class="btnUploadfile ${img_url===null?"":"notBlock"}"><i class="fa fa-upload "></i></label>
            <button class="btnDeleteImage ${img_url!==null?"":"notBlock"}" type="button" onclick="fntDelItem('#div${key}')" ${img_name===null?"":`img_name="${img_name}"`} ><i class="fa fa-trash"></i></button>
          ${posicion===null?"":`</div>`}`}function urlTablaFiltrada(){let cat="&cat="+document.getElementById("filtro_categoria").value;let premin="&premin="+document.getElementById("filtro_montoMinimo").value;let premax="&premax="+document.getElementById("filtro_montoMaximo").value;let estado="&estado="+document.getElementById("filtro_estado").value;return cat+premin+premax+estado}
function filtrarTablaProductos(){document.querySelector("#formFiltroTableProductos").onclick=function(e){e.preventDefault();tableProductos.ajax.url(base_url+"productos/getProductos"+urlTablaFiltrada()).load()}}
function opcionesFiltroCategoria(){fetch(base_url+"productos/getCategoriasProducto").then(res=>res.text()).then(res=>{let opciones=document.getElementById("filtro_categoria");let pevValor=opciones.value===""?0:opciones.value;opciones.innerHTML=`<option value='0'>Todo</option>`+res;opciones.options[pevValor].selected=true;opciones.selectedIndex=pevValor;choiseFiltroListCategoria=new Choices(opciones,{shouldSort:false,searchPlaceholderValue:"Buscar Categoria",itemSelectText:"<-"})})}
tableProductos=$("#tableProductos").DataTable({"destroy":true,"stateSave":true,"responsive":true,"search":true,"searching":true,"iDisplayLength":25,"order":[],dom:'<"row"<"col-sm-12 col-md-4"l><"col-sm-12 col-md-4"<"dt-buttons btn-group flex-wrap"B>><"col-sm-12 col-md-4"f>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',"language":{"sProcessing":"Procesando...","sLengthMenu":"Mostrar _MENU_ registros","sZeroRecords":"No se encontraron resultados","sEmptyTable":"Ning\u00fan dato disponible en esta tabla",
"sInfo":"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros","sInfoEmpty":"Mostrando registros del 0 al 0 de un total de 0 registros","sInfoFiltered":"(filtrado de un total de _MAX_ registros)","sInfoPostFix":"","sSearch":"Buscar:","sUrl":"","sInfoThousands":",","sLoadingRecords":"Cargando...","oPaginate":{"sFirst":"Primero","sLast":"\u00daltimo","sNext":"Siguiente","sPrevious":"Anterior"},"oAria":{"sSortAscending":": Activar para ordenar la columna de manera ascendente","sSortDescending":": Activar para ordenar la columna de manera descendente"},
"buttons":{"copy":"Copiar","colvis":"Visibilidad"}},"ajax":{url:base_url+"productos/getProductos"+urlTablaFiltrada(),dataSrc:""},"columns":[{"data":"idproducto"},{"data":"img_prod"},{"data":"codigo"},{"data":"nombre"},{"data":"categoria"},{"data":"precio"},{"data":"stock"},{"data":"options"},{"data":"descripcion"},{"data":"img_url"},{"data":"ruta"}],"columnDefs":[{"targets":[0],"className":"text-rigth align-middle",orderable:false,searchable:false,visible:false},{"targets":[1],"className":"text-rigth align-middle",
orderable:false,searchable:false},{"targets":[2],"className":"text-rigth align-middle",orderable:false,searchable:false,visible:false},{"targets":[3],"className":"text-center align-middle",orderable:false},{"targets":[4],"className":"text-center align-middle",orderable:false},{"targets":[5],"className":"text-center align-middle",orderable:false},{"targets":[6],"className":"text-center align-middle",orderable:false},{"targets":[7],"className":"text-center align-middle",orderable:false,searchable:false},
{"targets":[8],"className":"text-rigth align-middle",orderable:false,searchable:false,visible:false},{"targets":[9],"className":"text-rigth align-middle",orderable:false,searchable:false,visible:false},{"targets":[10],"className":"text-rigth align-middle",orderable:false,searchable:false,visible:false}],buttons:[{extend:"csv",text:"Exportar a CSV",ttleAtter:"Exportar a CSV",className:"btn btn-warning",exportOptions:{modifier:{search:"none"}}}]});
function nvoProducto(){document.querySelector("#idProducto").value="";document.querySelector(".modal-header").classList.replace("headerUpdate","headerRegister");document.querySelector(".btnDuplicar").classList.add("notBlock");document.querySelector("#btnActionForm").classList.replace("btn-info","btn-primary");document.querySelector(".modal-title").innerHTML="Nuevo";document.querySelector("#btnText").innerHTML="Guardar";document.querySelector("#formProducto").reset();document.querySelector("#opcionesCompartir").innerHTML=
"";document.querySelector("#containerGallery").classList.add("notBlock");document.querySelector("#containerImages").innerHTML="";document.querySelector("#pagina_prev").innerHTML="";document.querySelector("#pagina_poss").innerHTML="";document.querySelector("#pagina_prox").innerHTML="";formProducto()}
function fntEdit(id){let idProd=id;fetch(base_url+"productos/getProducto/"+idProd+urlTablaFiltrada()).then(objData=>objData.json()).then(objData=>{if(objData.status){document.querySelector("#formProducto").reset();document.querySelector(".modal-title").innerHTML="Actualizar";document.querySelector(".modal-header").classList.replace("headerRegister","headerUpdate");document.querySelector(".btnDuplicar").classList.remove("notBlock");document.querySelector("#btnActionForm").classList.replace("btn-primary",
"btn-info");document.querySelector("#btnText").innerHTML="Guardar";document.querySelector("#containerGallery").classList.remove("notBlock");let htmlImage="";let objProducto=objData.data;document.querySelector("#idProducto").value=objProducto.idproducto;document.querySelector("#txtNombre").value=objProducto.nombre;tinymce.get("txtDescripcion").setContent(objProducto.descripcion);tinymce.get("txtDetalle").setContent(objProducto.detalle);document.querySelector("#txtMarca").value=objProducto.marca;document.querySelector("#txtEtiquetas").value=
objProducto.etiquetas;document.querySelector("#txtCodigo").value=objProducto.codigo;document.querySelector("#listGrupoEtario").value=objProducto.age_group;document.querySelector("#listGenero").value=objProducto.gender;document.querySelector("#txtTalla").value=objProducto.size;document.querySelector("#txtColor").value=objProducto.color;document.querySelector("#txtMaterial").value=objProducto.material;document.querySelector("#txtEstilo").value=objProducto.style;document.querySelector("#txtEstampado").value=
objProducto.pattern;document.getElementById("txtStock").value=objProducto.stock;document.getElementById("list_stock_status").value=objProducto.stock_status;choiseListCategoria.setChoiceByValue(objProducto.categoriaid);getCategoriaFBGG(objProducto.categoriaid,objProducto.cat_facebook_id,objProducto.cat_google_id);choiseListProveedor.setChoiceByValue(objProducto.proveedorid);document.getElementById("listStatus").value=objProducto.status;let urlProd=base_url+"tienda/producto/"+objProducto.ruta;let divCompartir=
`
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('http://www.facebook.com/sharer/sharer.php?display=popup&u=${urlProd}', 'facebook-share-dialog', 'toolbar=0, status=0, width = 400, height = 550'); return false;" data-tooltip="Facebook"><i class="fab fa-facebook"></i></a>
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://twitter.com/intent/tweet?text=${objProducto.nombre}%0A&url=${urlProd}','twitter-share-dialog', 'toolbar=0, status=0,width=650,height=400,modal=yes');return false;"   data-tooltip="Twitter"><i class="fab fa-twitter"></i></a> 
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://wa.me/?url=${objProducto.nombre}&text=%0A${urlProd}','WhatsApp-share-dialog', 'toolbar=0, status=0,width = 800,height = 1000,modal=yes');return false;"  data-tooltip="WhatsApp"><i class="fab fa-whatsapp" aria-hidden="true"></i></a> 
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://t.me/share/url?url=${objProducto.nombre}%0A${urlProd}&text=${objProducto.nombre}&to=','telegram-share-dialog', 'toolbar=0, status=0,width = 500,height = 500,modal=yes');return false;" data-tooltip="Telegram"><i class="fab fa-telegram" aria-hidden="true"></i></a>`;document.querySelector("#opcionesCompartir").innerHTML=divCompartir;document.querySelector("#costoUSD").value=objProducto.costo;document.querySelector("#costoPeso").value=
parseFloat(objProducto.costo*dolarHoy).toFixed(0);document.querySelector("#precioUSD").value=objProducto.precio;document.querySelector("#precioPeso").value=parseFloat(objProducto.precio*dolarHoy).toFixed(0);calcularDiferencia();calcularPorciento(objProducto.costo,objProducto.precio);document.querySelector("#ofertaDolar").value=objProducto.oferta;document.querySelector("#ofertaPesos").value=parseFloat(objProducto.oferta/10*dolarHoy*10).toFixed(0);document.querySelector("#ofertaFechaInicio").value=
objProducto.oferta_f_ini;document.querySelector("#ofertaFechaFin").value=objProducto.oferta_f_fin;if(objProducto.images.length>0){let objProImages=objProducto.images;document.querySelector('[data-forden="1"]');for(let p=0;p<objProImages.length;p++){let key=objProImages[p].id;htmlImage+=contDivImg(key,objProImages[p].img,objProImages[p].url_image,objProImages[p].url_thumb,objProImages[p].posicion)}}document.querySelector("#containerImages").innerHTML=htmlImage;document.querySelector("#pagina_prev").innerHTML=
objProducto.prev===0?"":'<button class="page-item page-link  pull-left" onClick="fntEdit('+objProducto.prev+')" style="margin: auto;"><i class="fa fa-arrow-left" aria-hidden="true"></i></button>';document.querySelector("#pagina_prox").innerHTML=objProducto.prox===0?"":'<button class="page-item page-link pull-right" onClick="fntEdit('+objProducto.prox+')" style="margin: auto;"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>';document.querySelector("#pagina_poss").innerHTML='<span class="text-primary" >'+
objProducto.posicion+"</span>";formProducto();ligthbbox_reload()}else Swal.fire("Error",objData.msg,"error")}).catch(err=>window.alert(err))}document.querySelector("#listCategoria").onchange=async function(){await getCategoriaFBGG(this.value)};
async function getCategoriaFBGG(categoriaid,set_id_fb=0,set_id_gg=0){let url=base_url+"categorias/getCateFb_paraProductos/"+categoriaid;await fetch(url).then(objData=>objData.json()).then(objData=>{let list_fb=document.querySelector("#listCatFB");list_fb.innerHTML=objData.facebook;list_fb.value=set_id_fb;let list_google=document.querySelector("#listCatGoogle");list_google.innerHTML=objData.google;list_google.value=set_id_gg})}
function formProducto(){$("#modalFormProducto").modal("show");let formProducto=document.querySelector("#formProducto");formProducto.onsubmit=function(e){e.preventDefault();let strNombre=document.querySelector("#txtNombre").value;let strCodigo=document.querySelector("#txtCodigo").value;let strPrecio=document.querySelector("#precioUSD").value;let strStock=document.querySelector("#txtStock").value;if(strNombre===""||strPrecio===""||strStock===""){Swal.fire("atencion","todos los campos son obligatorios.",
"error");return false}tinymce.triggerSave();let formData=new FormData(formProducto);fetch(base_url+"productos/setProducto",{method:"POST",body:formData}).then(objData=>objData.json()).then(objData=>{if(objData.status){Swal.fire("Productos",objData.msg,"success");fntEdit(objData.idproducto);filtrarTablaProductos();tableProductos.ajax.reload(null,false)}else Swal.fire("Error",objData.msg,"error")})}}
function fntVer(id){let idProd=id;fetch(base_url+"productos/getProducto/"+idProd+urlTablaFiltrada()).then(objData=>objData.json()).then(objData=>{if(objData.status){let objProducto=objData.data;document.querySelector("#celCodigo").innerHTML=objProducto.codigo;document.querySelector("#celNombre").innerHTML=objProducto.nombre;document.querySelector("#celPrecio").innerHTML=parseFloat(objProducto.precio*dolarHoy).toFixed(2);document.querySelector("#celStock").innerHTML=objProducto.stock;document.querySelector("#celCategoria").innerHTML=
objProducto.categoria;document.querySelector("#celProveedor").innerHTML=objProducto.proveedor;document.querySelector("#celDescripcion").innerHTML=objProducto.descripcion;let urlProd=base_url+"tienda/producto/"+objProducto.ruta;document.querySelector("#opcionesCompartir2").innerHTML=`
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('http://www.facebook.com/sharer/sharer.php?display=popup&u=${urlProd}', 'facebook-share-dialog', 'toolbar=0, status=0, width = 400, height = 550'); return false;" data-tooltip="Facebook"><i class="fab fa-facebook"></i></a>
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://twitter.com/intent/tweet?text=${objProducto.nombre}%0A&url=${urlProd}','twitter-share-dialog', 'toolbar=0, status=0,width=650,height=400,modal=yes');return false;"   data-tooltip="Twitter"><i class="fab fa-twitter"></i></a> 
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://wa.me/?url=${objProducto.nombre}&text=%0A${urlProd}','WhatsApp-share-dialog', 'toolbar=0, status=0,width = 800,height = 1000,modal=yes');return false;"  data-tooltip="WhatsApp"><i class="fab fa-whatsapp" aria-hidden="true"></i></a> 
          <a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://t.me/share/url?url=${objProducto.nombre}%0A${urlProd}&text=${objProducto.nombre}&to=','telegram-share-dialog', 'toolbar=0, status=0,width = 500,height = 500,modal=yes');return false;" data-tooltip="Telegram"><i class="fab fa-telegram" aria-hidden="true"></i></a>`;document.querySelector("#pagina_prev2").innerHTML=objProducto.prev===0?"":'<button class="page-item page-link  pull-left" onClick="fntVer('+objProducto.prev+
')" style="margin: auto;"><i class="fa fa-arrow-left" aria-hidden="true"></i></button>';document.querySelector("#pagina_prox2").innerHTML=objProducto.prox===0?"":'<button class="page-item page-link pull-right" onClick="fntVer('+objProducto.prox+')" style="margin: auto;"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>';document.querySelector("#pagina_poss2").innerHTML='<span class="text-primary" >'+objProducto.posicion+"</span>";let htmlImage="";if(objProducto.images.length>0){let objProImages=
objProducto.images;for(let p=0;p<objProImages.length;p++)htmlImage+=`<div class="prod-pic-rel">
                           <a href="${objProImages[p].url_image}" class="prod-scale-img thumb preview-thumb image-popup">
                              <img src="${objProImages[p].url_thumb}" class="img-fluid " alt="work-thumbnail"> 
                           </a>
                        </div>
                  `}document.querySelector("#celFotos").innerHTML=htmlImage;ligthbbox_reload();$("#modalVerProducto").modal("show")}else Swal.fire("Error",objData.msg,"error")})}
function fntStatus(id){let boton=document.querySelector("#btnStatus"+id);fetch(base_url+"productos/statusChange/"+"?id="+id+"&intStatus="+boton.value).then(response=>response.json()).then(objData=>{if(objData.status)if(boton.value===1)boton.value=0,boton.classList.replace("btn-success","btn-danger");else boton.value=1,boton.classList.replace("btn-danger","btn-success");else Swal.fire("Atencio!",objData.msg,"error")}).catch(err=>Swal.fire("Atencio!",err,"error"))}
function fntDel(id){Swal.fire({title:"Quieres Eliminar Producto?",text:"esta accion es irreversible",icon:"warning",showCancelButton:true,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, estoy seguro",cancelButtonText:"No, Cancelar"}).then(result=>{if(result.isConfirmed){let ajaxUrlDel=base_url+"productos/delProducto";let arrData="id="+id;let cabecera={"Content-type":"application/x-www-form-urlencoded"};fetch(ajaxUrlDel,{method:"POST",headers:cabecera,body:arrData}).then(objData=>
objData.json()).then(objData=>{if(objData.status){Swal.fire({position:"top-end",icon:"success",title:objData.msg,showConfirmButton:false,timer:1500});tableProductos.ajax.reload(null,false)}else Swal.fire("Atencio!",objData.msg,"error")}).catch(err=>console.error(err))}})}
function csvFB(){fetch(base_url+"productos/getProductosCategoriaCSV/"+urlTablaFiltrada()).then(response=>response.blob()).then(blob=>URL.createObjectURL(blob)).then(uril=>{let link=document.createElement("a");link.href=uril;link.download="catalog_products.csv";document.body.appendChild(link);link.click();document.body.removeChild(link)})}
function fotoMovePos(accion){let a=event.target.parentNode.parentNode;let a_pos=parseInt(a.getAttribute("data-forden"));if(isNaN(a_pos)===true){a=a.parentNode;a_pos=parseInt(a.getAttribute("data-forden"))}let a_id=a.getAttribute("id");let pos=accion==="+"?a_pos+1:a_pos-1;let b=document.querySelector(`[data-forden="${pos}"]`);if(b!==null){let b_id=b.getAttribute("id");let ahtml=a.innerHTML;let bhtml=b.innerHTML;let formData=new FormData;formData.append("a_id",a_id);formData.append("a_pos",a_pos);formData.append("b_id",
b_id);formData.append("b_pos",pos);let img_cargando=`<img class="loading " data-mdb-animation="fade-out" src="${base_url}Assets/images/loading.svg" >`;a.childNodes[3].innerHTML=img_cargando;b.childNodes[3].innerHTML=img_cargando;fetch(base_url+"/Productos/setPosicionImg",{method:"POST",body:formData}).then(objData=>objData.json()).then(objData=>{a.setAttribute("id",b_id);a.innerHTML=bhtml;b.setAttribute("id",a_id);b.innerHTML=ahtml;if(a_pos===0||pos===0){filtrarTablaProductos();tableProductos.ajax.reload(null,
false)}})}}function fntDuplicar(){Swal.fire("Productos","Copia realizada en un nuevo item","success");document.querySelector("#idProducto").value="";document.querySelector("#containerGallery").classList.add("notBlock");document.querySelector("#containerImages").innerHTML="";document.querySelector("#pagina_prev").innerHTML="";document.querySelector("#pagina_poss").innerHTML="";document.querySelector("#pagina_prox").innerHTML=""}
function fntVerProvee(){let id=document.querySelector("#listProveedor").value;fetch(base_url+"productos/getProveedor/"+id).then(res=>res.json()).then(objData=>{if(objData.status){let estadoProveedor=objData.data.status===1?'<span class="bagde badge-success">Activo</option>':'<span class="badge badge-danger">Inactivo</option>';document.querySelector("#verProvID").innerHTML=objData.data.idproveedor;document.querySelector("#verProvNombre").innerHTML=objData.data.nombre;document.querySelector("#verProvDescripcion").innerHTML=
objData.data.descripcion;document.querySelector("#verProvDireccion").innerHTML=objData.data.direccion;document.querySelector("#verProvTelefono").innerHTML=objData.data.telf_local;document.querySelector("#verProvCelular").innerHTML=objData.data.telf_mobil;let divCompartir="";divCompartir+=objData.data.web!==""?`<a class="btn btn-outline-primary m-1" href="#" onclick="window.open('${objData.data.web}', 'web-share-dialog'); return false;" ><i class="fas fa-globe"></i></a>`:"";divCompartir+=objData.data.fb!==
""?`<a class="btn btn-outline-primary m-1" href="#" onclick="window.open('${objData.data.fb}', 'facebook-share-dialog'); return false;" data-tooltip="Facebook"><i class="fab fa-facebook"></i></a> `:"";divCompartir+=objData.data.fb!==""?`<a class="btn btn-outline-primary m-1" href="#" onclick="window.open('${objData.data.ig}', 'instagram-share-dialog'); return false;" data-tooltip="Instagram"><i class="fab fa-instagram"></i></a> `:"";divCompartir+=objData.data.telf_mobil!==""?`<a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://wa.me/${objData.data.telf_mobil}','WhatsApp-share-dialog');return false;"  data-tooltip="WhatsApp"><i class="fab fa-whatsapp" aria-hidden="true"></i></a> `:
"";divCompartir+=objData.data.telf_mobil!==""?`<a class="btn btn-outline-primary m-1" href="#" onclick="window.open('https://t.me/${objData.data.telf_mobil}','telegram-share-dialog');return false;" data-tooltip="Telegram"><i class="fab fa-telegram" aria-hidden="true"></i></a>`:"";document.querySelector("#verProvLinks").innerHTML=divCompartir;document.querySelector("#verProvFecha").innerHTML=objData.data.fecha;document.querySelector("#verProvEstado").innerHTML=estadoProveedor;document.querySelector("#verProvImgProveedor").innerHTML=
'<img src = "'+objData.data.url_img+'">';objData.data.prev===0?document.querySelector("#pagina_prev").innerHTML="":document.querySelector("#pagina_prev").innerHTML='<button class="page-item page-link pull-left" onClick="fntEdit('+objData.data.prev+')" >\u00ab</button>';objData.data.prox===0?document.querySelector("#pagina_prox").innerHTML="":document.querySelector("#pagina_prox").innerHTML='<button class="page-item page-link pull-right" onClick="fntEdit('+objData.data.prox+')" >\u00bb</button>';document.querySelector("#pagina_poss").innerHTML=
'<span class="text-primary" >'+objData.data.posicion+"</span>";$("#modalVerProveedor").modal("show")}else Swal.fire("Error",objData.msg,"error")}).catch(err=>console.error(err))};